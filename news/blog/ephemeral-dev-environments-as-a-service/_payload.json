[{"data":1,"prerenderedAt":1010},["ShallowReactive",2],{"RcuZoKEPPQ":3},{"pageSetup":4,"sections":15},{"keywords":5,"image":6,"title":10,"slug":11,"description":14},null,{"url":7,"width":8,"height":9},"https://cdn.sanity.io/images/40fnhjbe/production/08da37bc5656802b7a7f0f438f7a6e48e8431e06-3840x2160.png",3840,2160,"Ephemeral Dev Environments as a Service",{"_type":12,"current":13},"slug","ephemeral-dev-environments-as-a-service","Clear Street is a cloud-native financial technology firm on a mission to modernize the brokerage ecosystem.",{"header":16,"content":39,"footer":921},{"date":17,"summary":14,"author":18,"category":35,"title":10,"hello":38},"2021-12-13",{"_updatedAt":19,"_type":20,"photo":21,"_createdAt":28,"name":29,"slug":30,"_rev":32,"_id":33,"role":34},"2024-05-30T15:04:12Z","authors",{"height":22,"extension":23,"alt":5,"hotspot":5,"asset":24,"url":27,"width":22},480,"png",{"_ref":25,"_type":26},"image-f9f54b5f5240dfdb9749b6abea1e0ea4720c0dee-480x480-png","reference","https://cdn.sanity.io/images/40fnhjbe/production/f9f54b5f5240dfdb9749b6abea1e0ea4720c0dee-480x480.png","2024-02-16T14:38:42Z","Clear Street Engineering",{"_type":12,"current":31},"clear-street-engineering","oquihqXh9OzAvkinFGpwlk","FY3Umrpkptjq2bXyZZikKw","",{"name":36,"colorSlug":37},"Engineering","engineering","world",{"pressReleasesFootNote":40,"legalText":72,"form":111,"type":140,"readingTime":141,"body":142,"references":920},[41,53],{"_type":42,"style":43,"_key":44,"markDefs":45,"children":46},"block","normal","01d9743bd6e6",[],[47],{"_type":48,"marks":49,"text":51,"_key":52},"span",[50],"strong","About Clear Street:","820e76cb468a0",{"children":54,"_type":42,"style":43,"_key":68,"markDefs":69},[55,59,64],{"marks":56,"text":57,"_key":58,"_type":48},[],"Clear Street is modernizing the brokerage ecosystem with financial technology and services that empower market participants with real-time data and best-in-class products, tools and teams, to navigate capital markets around the world. Complemented by white-glove service, Clear Street's cloud-native, proprietary product suite delivers financing, derivatives, execution and more to power client success, adding efficiency to the market and enabling clients to minimize risk, redundancy and cost. Clear Street’s goal is to create a single platform for every asset class, in every country and in any currency. For more information, visit ","46cc6bc340df0",{"_type":48,"marks":60,"text":62,"_key":63},[61],"f69e401d33e9","https://clearstreet.io","46cc6bc340df1",{"marks":65,"text":66,"_key":67,"_type":48},[],".","46cc6bc340df2","6558fb161935",[70],{"_type":71,"href":62,"_key":61},"link",[73,103],{"children":74,"_type":42,"style":43,"_key":97,"markDefs":98},[75,79,84,88,93],{"marks":76,"text":77,"_key":78,"_type":48},[],"Clear Street does not provide investment, legal, regulatory, tax, or compliance advice. Consult professionals in these fields to address your specific circumstances. These materials are: (i) solely an overview of Clear Street’s products and services; (ii) provided for informational purposes only; and (iii) subject to change without notice or obligation to replace any information contained therein.\n\nProducts and services are offered by Clear Street LLC as a Broker Dealer member FINRA and SIPC and a Futures Commission Merchant registered with the CFTC and member of NFA. Additional information about Clear Street is available on FINRA ","e217f565c4110",{"marks":80,"text":82,"_key":83,"_type":48},[81],"10659f16c05f","BrokerCheck","e217f565c4111",{"_type":48,"marks":85,"text":86,"_key":87},[],", including its Customer Relationship Summary and NFA ","e217f565c4112",{"marks":89,"text":91,"_key":92,"_type":48},[90],"3c111ef5e988","BASIC | NFA (futures.org)","e217f565c4113",{"_type":48,"marks":94,"text":95,"_key":96},[],".\n‍\nCopyright © 2024 Clear Street LLC. All rights reserved. Clear Street and the Shield Logo are Registered Trademarks of Clear Street LLC\n","e217f565c4114","cd3115128082",[99,101],{"_type":71,"href":100,"_key":81},"https://brokercheck.finra.org/firm/summary/288933",{"_type":71,"href":102,"_key":90},"https://www.nfa.futures.org/BasicNet/basic-profile.aspx?nfaid=XCoGScQYyvw%3D",{"_key":104,"markDefs":105,"children":106,"_type":42,"style":43},"38805a72b34d",[],[107],{"marks":108,"text":109,"_key":110,"_type":48},[],"\n","a19adde9170f0",{"title":112,"slug":113,"fields":114},"Contact","contact",[115,121,126,131,135],{"_type":116,"name":117,"label":118,"required":119,"errorMessage":120},"field.string","full-name","Full name",true,"Please add your full name",{"name":122,"label":123,"required":119,"errorMessage":124,"_type":125},"work-email","Work email","Invalid email","field.email",{"_type":127,"name":128,"label":129,"required":119,"errorMessage":130},"field.phone","work-phone","Work phone","Please add your work phone",{"label":132,"required":119,"errorMessage":133,"_type":116,"name":134},"Company","Please add your company","company",{"name":136,"label":137,"required":138,"errorMessage":5,"_type":139},"message","Message (optional)",false,"field.text","blog",12,[143,151,158,177,184,203,210,218,225,233,240,250,258,266,274,283,291,298,317,325,333,352,360,368,398,406,414,422,430,437,454,461,469,476,492,499,518,525,540,547,555,563,570,586,593,601,609,617,625,632,648,655,663,693,699,707,715,733,740,748,756,764,771,790,798,806,813,829,836,844,863,870,897,904,912],{"_key":144,"markDefs":145,"children":146,"_type":42,"style":43},"c1ad8e7edce9",[],[147],{"_type":48,"marks":148,"text":149,"_key":150},[],"Testing is important, especially at Clear Street. Our system processes millions of trades a day and correctness is vital in our industry. Before Ivy (a.k.a., Clear Street’s branch deploy service…more on that later) developers had two main environments where they could interactively end-to-end test their code: their local Kubernetes environment and the Dev environment. We also ran unit tests and integration tests in CI and on our local machines.","c1ad8e7edce90",{"style":43,"_key":152,"markDefs":153,"children":154,"_type":42},"6a1024214807",[],[155],{"_key":156,"_type":48,"marks":157,"text":34},"6a10242148070",[],{"_type":42,"style":43,"_key":159,"markDefs":160,"children":164},"557011bdf6e0",[161],{"_type":71,"to":162,"_key":163},"https://medium.com/clear-street/why-we-moved-to-local-kubernetes-development-at-clear-street-523045dd2ac8","80761db6da1d",[165,169,173],{"_key":166,"_type":48,"marks":167,"text":168},"557011bdf6e00",[],"A Clear Street developer’s ",{"marks":170,"text":171,"_key":172,"_type":48},[163],"local Kubernetes environment","557011bdf6e01",{"_type":48,"marks":174,"text":175,"_key":176},[],", or as we like to call it, localkube, is great because of its fast feedback loop and isolation. It allows developers to quickly develop new features for their applications as well as experiment with Kubernetes configuration changes such as liveness and readiness probes.","557011bdf6e02",{"_type":42,"style":43,"_key":178,"markDefs":179,"children":180},"85777bbf78ea",[],[181],{"_type":48,"marks":182,"text":34,"_key":183},[],"85777bbf78ea0",{"children":185,"_type":42,"style":43,"_key":199,"markDefs":200},[186,190,195],{"text":187,"_key":188,"_type":48,"marks":189},"Even with all these benefits, local interactive testing has its limits. Namely, it’s hard to collaborate with others while testing a change. This is why we also utilize our Dev environment to test our services before merging changes to the main branch. Using ","884f30d698d90",[],{"_type":48,"marks":191,"text":193,"_key":194},[192],"ca13f12ee870","SLeD","884f30d698d91",{"_type":48,"marks":196,"text":197,"_key":198},[]," (Clear Street’s service level deploys tool), our developers can “beta deploy” unmerged code to our Dev environment. Once a change is beta deployed, engineers, designers, operations staff, and other stakeholders can work together to ensure the change behaves as expected.","884f30d698d92","884f30d698d9",[201],{"_type":71,"to":202,"_key":192},"https://medium.com/clear-street/service-level-deploys-or-how-we-learned-to-stop-worrying-and-love-artifacts-6daca4c32fe0",{"style":43,"_key":204,"markDefs":205,"children":206,"_type":42},"33d5f34fdf98",[],[207],{"_type":48,"marks":208,"text":34,"_key":209},[],"33d5f34fdf980",{"markDefs":211,"children":212,"_type":42,"style":43,"_key":217},[],[213],{"text":214,"_key":215,"_type":48,"marks":216},"While beta deploys are great for test collaboration, it increases contention in our Dev environment. For example, an engineer may want to beta deploy their UI changes for a designer to verify that it works as expected, but other engineers cannot beta deploy the same service until the designer is done with their testing. As our teams scaled and more engineers worked on the same service, this contention only got worse. In addition, collaborative testing in our Dev environment is hampered by instability. Someone may beta deploy a buggy version of a service that I depend on, making it much harder to test my service.","341c4d045efc0",[],"341c4d045efc",{"children":219,"_type":42,"style":43,"_key":223,"markDefs":224},[220],{"_type":48,"marks":221,"text":34,"_key":222},[],"1415fd07a78f0","1415fd07a78f",[],{"_key":226,"markDefs":227,"children":228,"_type":42,"style":43},"2f34ffe1204f",[],[229],{"marks":230,"text":231,"_key":232,"_type":48},[],"For us, the natural solution to these problems was branch deploys: the ability to deploy any branch to an isolated and ephemeral environment. Our ideal workflow was simple:","2f34ffe1204f0",{"style":43,"_key":234,"markDefs":235,"children":236,"_type":42},"642fba13c077",[],[237],{"marks":238,"text":34,"_key":239,"_type":48},[],"642fba13c0770",{"style":43,"_key":241,"listItem":242,"markDefs":243,"children":244,"level":249,"_type":42},"3a496e7918db","bullet",[],[245],{"marks":246,"text":247,"_key":248,"_type":48},[],"A user requests a branch deploy for their branch.","3a496e7918db0",1,{"style":43,"_key":251,"listItem":242,"markDefs":252,"children":253,"level":249,"_type":42},"9d2251a6f181",[],[254],{"_type":48,"marks":255,"text":256,"_key":257},[],"Once the branch deploy environment is created, users are able to access services through a static URL (e.g., web.cool-meadow-380.ivy.co.clearstreet.io for our website).","9d2251a6f1810",{"level":249,"_type":42,"style":43,"_key":259,"listItem":242,"markDefs":260,"children":261},"2752c6da7d78",[],[262],{"_type":48,"marks":263,"text":264,"_key":265},[],"Users can push changes to their branch which are reflected in their branch deploy.","2752c6da7d780",{"style":43,"_key":267,"listItem":242,"markDefs":268,"children":269,"level":249,"_type":42},"098165659aac",[],[270],{"_type":48,"marks":271,"text":272,"_key":273},[],"The branch deploy environment is torn down once it’s no longer needed.","098165659aac0",{"_type":42,"style":275,"_key":276,"markDefs":277,"children":278},"h5","e77ace728eee",[],[279],{"marks":280,"text":281,"_key":282,"_type":48},[50],"Building Ivy","e77ace728eee0",{"_key":284,"markDefs":285,"children":286,"_type":42,"style":43},"db9b52d2fbd7",[],[287],{"marks":288,"text":289,"_key":290,"_type":48},[],"We decided to call our branch deploy system Ivy, and we set about making it a reality. In addition to providing the branch deploy workflow above, we wanted Ivy to be fast and easy to use. We didn’t want users to have to wait around for branch deploys to be created, and we also wanted non-engineers to be able to use the system so all stakeholders of a service can be part of the testing.","db9b52d2fbd70",{"_type":42,"style":43,"_key":292,"markDefs":293,"children":294},"75ce4aab5311",[],[295],{"_key":296,"_type":48,"marks":297,"text":34},"75ce4aab53110",[],{"style":43,"_key":299,"markDefs":300,"children":304,"_type":42},"ef2b09b2c7b5",[301],{"_type":71,"to":302,"_key":303},"https://tilt.dev/","e594d9530ab9",[305,309,313],{"_type":48,"marks":306,"text":307,"_key":308},[],"Our work with localkube gave us a strong foundation on which to build Ivy. With localkube, we could essentially spin up our entire stack with a few simple ","ef2b09b2c7b50",{"_type":48,"marks":310,"text":311,"_key":312},[303],"Tilt","ef2b09b2c7b51",{"_type":48,"marks":314,"text":315,"_key":316},[]," commands. With that, Ivy’s job became quite streamlined. All Ivy had to do was:","ef2b09b2c7b52",{"_key":318,"listItem":242,"markDefs":319,"children":320,"level":249,"_type":42,"style":43},"bf73a9346181",[],[321],{"_type":48,"marks":322,"text":323,"_key":324},[],"Accept a request to create a branch deploy with some set of Tilt arguments.","bf73a93461810",{"markDefs":326,"children":327,"level":249,"_type":42,"style":43,"_key":332,"listItem":242},[],[328],{"_type":48,"marks":329,"text":330,"_key":331},[],"Provision an EC2 instance and set up DNS for a custom domain (e.g., cool-meadow-380.ivy.co.clearstreet.io).","8bd8e62204570","8bd8e6220457",{"_key":334,"listItem":242,"markDefs":335,"children":339,"level":249,"_type":42,"style":43},"7465e148e070",[336],{"_key":337,"_type":71,"to":338},"f97018fc286e","https://kind.sigs.k8s.io/",[340,344,348],{"_type":48,"marks":341,"text":342,"_key":343},[],"Install dependencies and spin up a ","7465e148e0700",{"_type":48,"marks":345,"text":346,"_key":347},[337],"kind","7465e148e0701",{"text":349,"_key":350,"_type":48,"marks":351}," Kubernetes cluster on the EC2 instance.","7465e148e0702",[],{"level":249,"_type":42,"style":43,"_key":353,"listItem":242,"markDefs":354,"children":355},"3dcf5e249a35",[],[356],{"marks":357,"text":358,"_key":359,"_type":48},[],"Run tilt up with the supplied arguments.","3dcf5e249a350",{"markDefs":361,"children":362,"level":249,"_type":42,"style":43,"_key":367,"listItem":242},[],[363],{"_key":364,"_type":48,"marks":365,"text":366},"4d53a42b5f610",[],"Clean up all resources when the branch deploy is no longer needed.","4d53a42b5f61",{"_key":369,"markDefs":370,"children":377,"_type":42,"style":43},"57c57b54899a",[371,374],{"_type":71,"to":372,"_key":373},"https://www.terraform.io/","ef9b79e01a43",{"_type":71,"to":375,"_key":376},"https://www.ansible.com/","d2fa55fc7ea8",[378,382,386,390,394],{"_type":48,"marks":379,"text":380,"_key":381},[],"We decided to use ","57c57b54899a0",{"_type":48,"marks":383,"text":384,"_key":385},[373],"Terraform","57c57b54899a1",{"_type":48,"marks":387,"text":388,"_key":389},[]," to provision and clean up AWS resources associated with a branch deploy. Once an EC2 instance is created, we use ","57c57b54899a2",{"_type":48,"marks":391,"text":392,"_key":393},[376],"Ansible","57c57b54899a3",{"_type":48,"marks":395,"text":396,"_key":397},[]," to connect to the instance and run some setup scripts. Ivy also listens to a webhook from our GitLab instance, and if there’s a push to a branch with a branch deploy we run a git pull on the instance to update its code and trigger rebuilds of services. Branch deploys are also cleaned up automatically if they are stale or if the branch has been merged, although users can opt out of auto termination. With Ivy working as intended, we decided to release it to everyone at Clear Street to use as part of their day-to-day workflow.","57c57b54899a4",{"markDefs":399,"children":400,"_type":42,"style":275,"_key":405},[],[401],{"marks":402,"text":403,"_key":404,"_type":48},[50],"Using Ivy","874073b7ec420","874073b7ec42",{"children":407,"_type":42,"style":43,"_key":412,"markDefs":413},[408],{"_type":48,"marks":409,"text":410,"_key":411},[],"There are two ways users interact with Ivy: a web UI and ChatOps on GitLab. Ivy has an API too so automation, like CI, can take advantage of its capabilities.","2affc9d589420","2affc9d58942",[],{"markDefs":415,"children":416,"_type":42,"style":275,"_key":421},[],[417],{"_type":48,"marks":418,"text":419,"_key":420},[50],"Web UI","2d2bfaea0d900","2d2bfaea0d90",{"style":43,"_key":423,"markDefs":424,"children":425,"_type":42},"3cb496a6ec52",[],[426],{"_type":48,"marks":427,"text":428,"_key":429},[],"The Ivy web UI has a dashboard that shows users their active and past branch deploys. From the dashboard, users can easily access a branch deploy as well as perform actions such as updates and terminations.","3cb496a6ec520",{"_type":42,"style":43,"_key":431,"markDefs":432,"children":433},"341bff723342",[],[434],{"text":34,"_key":435,"_type":48,"marks":436},"341bff7233420",[],{"caption":438,"asset":447,"_type":449,"url":450,"hotspot":5,"alt":445,"_key":451,"children":5,"width":452,"height":453,"extension":23},[439],{"style":43,"_key":440,"markDefs":441,"children":442,"_type":42},"fed028c8fc83",[],[443],{"marks":444,"text":445,"_key":446,"_type":48},[],"Ivy web UI user dashboard page","fed028c8fc830",{"_ref":448,"_type":26},"image-7fc2816fe583ad0b05d065f5c531c082b0b17a05-1400x823-png","figureNews","https://cdn.sanity.io/images/40fnhjbe/production/7fc2816fe583ad0b05d065f5c531c082b0b17a05-1400x823.png","43245d686383",1400,823,{"markDefs":455,"children":456,"_type":42,"style":43,"_key":460},[],[457],{"text":34,"_key":458,"_type":48,"marks":459},"8f7f7d0b8c250",[],"8f7f7d0b8c25",{"markDefs":462,"children":463,"_type":42,"style":43,"_key":468},[],[464],{"text":465,"_key":466,"_type":48,"marks":467},"Users can easily create a new branch deploy by using the “+” icon and entering a branch name as well as some Tilt arguments.","60e7ae4b4acd0",[],"60e7ae4b4acd",{"style":43,"_key":470,"markDefs":471,"children":472,"_type":42},"fe1c91242c7d",[],[473],{"marks":474,"text":34,"_key":475,"_type":48},[],"fe1c91242c7d0",{"hotspot":5,"url":477,"height":478,"_type":449,"alt":479,"caption":480,"asset":488,"children":5,"_key":490,"extension":23,"width":491},"https://cdn.sanity.io/images/40fnhjbe/production/d36a4ecaeea6d0127963a1fcb767f4555f28c448-818x540.png",540,"Creating a branch deploy in the Ivy web UI",[481],{"children":482,"_type":42,"style":43,"_key":486,"markDefs":487},[483],{"_type":48,"marks":484,"text":479,"_key":485},[],"c9710ebadd5d0","c9710ebadd5d",[],{"_ref":489,"_type":26},"image-d36a4ecaeea6d0127963a1fcb767f4555f28c448-818x540-png","dae97408f263",818,{"_key":493,"markDefs":494,"children":495,"_type":42,"style":43},"6eab0fccce5f",[],[496],{"_type":48,"marks":497,"text":34,"_key":498},[],"6eab0fccce5f0",{"style":43,"_key":500,"markDefs":501,"children":505,"_type":42},"e9580c3c7b89",[502],{"_type":71,"to":503,"_key":504},"https://www.datadoghq.com/","3af1f502a7cc",[506,510,514],{"_key":507,"_type":48,"marks":508,"text":509},"e9580c3c7b890",[],"The branch deploy dashboard presents detailed information about a branch deploy. It also links to a ",{"_type":48,"marks":511,"text":512,"_key":513},[504],"DataDog","e9580c3c7b891",{"_type":48,"marks":515,"text":516,"_key":517},[]," dashboard with metrics related to the EC2 instance such as CPU and memory utilization.","e9580c3c7b892",{"style":43,"_key":519,"markDefs":520,"children":521,"_type":42},"24cba46efbcd",[],[522],{"_type":48,"marks":523,"text":34,"_key":524},[],"24cba46efbcd0",{"caption":526,"_key":535,"children":5,"height":536,"url":537,"hotspot":5,"asset":538,"_type":449,"alt":534,"width":452,"extension":23},[527],{"_type":42,"style":43,"_key":528,"markDefs":529,"children":530},"629669831f87",[],[531],{"_key":532,"_type":48,"marks":533,"text":534},"629669831f870",[],"Branch deploy details page","f3e8b6f317cf",810,"https://cdn.sanity.io/images/40fnhjbe/production/196274b1695a3686ccd0492a244b1352e39de889-1400x810.png",{"_ref":539,"_type":26},"image-196274b1695a3686ccd0492a244b1352e39de889-1400x810-png",{"children":541,"_type":42,"style":43,"_key":545,"markDefs":546},[542],{"_type":48,"marks":543,"text":34,"_key":544},[],"4c7e68fe14170","4c7e68fe1417",[],{"style":275,"_key":548,"markDefs":549,"children":550,"_type":42},"08a1735bdd62",[],[551],{"_key":552,"_type":48,"marks":553,"text":554},"08a1735bdd620",[50],"ChatOps on GitLab Merge Requests",{"markDefs":556,"children":557,"_type":42,"style":43,"_key":562},[],[558],{"_type":48,"marks":559,"text":560,"_key":561},[],"For our developers, one of the most intuitive ways to interact with Ivy is through ChatOps on an open GitLab merge request (i.e., pull request). Ivy has a fairly intuitive chat interface for creating and managing branch deploys so that branch deploys seamlessly integrate with a developer’s natural workflow.","ce69471485700","ce6947148570",{"children":564,"_type":42,"style":43,"_key":568,"markDefs":569},[565],{"text":34,"_key":566,"_type":48,"marks":567},"2c0666df15b50",[],"2c0666df15b5",[],{"_type":449,"alt":571,"_key":572,"height":573,"asset":574,"caption":576,"extension":23,"hotspot":5,"url":584,"width":585,"children":5},"Example chat with Ivy to create, update, and terminate a branch deploy.","aa918520b870",866,{"_ref":575,"_type":26},"image-948d724e61cae2164c4ab588ce1c09877d2907d8-995x866-png",[577],{"children":578,"_type":42,"style":43,"_key":582,"markDefs":583},[579],{"_type":48,"marks":580,"text":571,"_key":581},[],"0e5c20eb79a10","0e5c20eb79a1",[],"https://cdn.sanity.io/images/40fnhjbe/production/948d724e61cae2164c4ab588ce1c09877d2907d8-995x866.png",995,{"markDefs":587,"children":588,"_type":42,"style":43,"_key":592},[],[589],{"_type":48,"marks":590,"text":34,"_key":591},[],"c37bf17cdf890","c37bf17cdf89",{"markDefs":594,"children":595,"_type":42,"style":275,"_key":600},[],[596],{"_key":597,"_type":48,"marks":598,"text":599},"1ab14b2198fd0",[50],"Challenges","1ab14b2198fd",{"children":602,"_type":42,"style":43,"_key":607,"markDefs":608},[603],{"_type":48,"marks":604,"text":605,"_key":606},[],"We faced several challenges while building Ivy, but there are two, in particular, we’d like to highlight.","6fb576d516af0","6fb576d516af",[],{"style":275,"_key":610,"markDefs":611,"children":612,"_type":42},"8b055e31ec1b",[],[613],{"text":614,"_key":615,"_type":48,"marks":616},"Networking","8b055e31ec1b0",[50],{"markDefs":618,"children":619,"_type":42,"style":43,"_key":624},[],[620],{"text":621,"_key":622,"_type":48,"marks":623},"It took us several iterations to get networking to work in a way we felt was reliable. By networking, we mean the ability for a user to visit web.cool-meadow-380.ivy.co.clearstreet.io on their browser and access an instance of the website running in a branch deploy. Here’s a diagram that shows the hops a request to a branch deploy needs to take:","e9273dffe6a30",[],"e9273dffe6a3",{"_type":42,"style":43,"_key":626,"markDefs":627,"children":628},"3b1b605c68ce",[],[629],{"_type":48,"marks":630,"text":34,"_key":631},[],"3b1b605c68ce0",{"alt":633,"height":634,"hotspot":5,"url":635,"caption":636,"_key":644,"asset":645,"children":5,"_type":449,"width":647,"extension":23},"The route a request to a branch deploy takes",461,"https://cdn.sanity.io/images/40fnhjbe/production/b76bb73eceee0ee3c6b25b9392d03ce9ab03109b-1308x461.png",[637],{"children":638,"_type":42,"style":43,"_key":642,"markDefs":643},[639],{"_type":48,"marks":640,"text":633,"_key":641},[],"e89b721599210","e89b72159921",[],"371641e58f0d",{"_ref":646,"_type":26},"image-b76bb73eceee0ee3c6b25b9392d03ce9ab03109b-1308x461-png",1308,{"_type":42,"style":43,"_key":649,"markDefs":650,"children":651},"6c8c9572aea1",[],[652],{"text":34,"_key":653,"_type":48,"marks":654},"6c8c9572aea10",[],{"markDefs":656,"children":657,"_type":42,"style":275,"_key":662},[],[658],{"marks":659,"text":660,"_key":661,"_type":48},[50],"Traefik Setup","5de2f862f4fb0","5de2f862f4fb",{"_type":42,"style":43,"_key":664,"markDefs":665,"children":672},"98206d73567c",[666,669],{"_key":667,"_type":71,"to":668},"174d6b3820c1","https://traefik.io/",{"to":670,"_key":671,"_type":71},"https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/","d750c046f98b",[673,677,681,685,689],{"text":674,"_key":675,"_type":48,"marks":676},"As the above diagram shows, a request to a branch deploy instance first goes through a ","98206d73567c0",[],{"_type":48,"marks":678,"text":679,"_key":680},[667],"Traefik","98206d73567c1",{"_type":48,"marks":682,"text":683,"_key":684},[]," proxy. This proxy accepts incoming requests and rewrites the hostname to a format the ","98206d73567c2",{"_type":48,"marks":686,"text":687,"_key":688},[671],"Ingress Controller","98206d73567c3",{"_key":690,"_type":48,"marks":691,"text":692},"98206d73567c4",[]," in the kind cluster can understand if the request is for something in the kind cluster. Such rewritten requests are handed off to the Ingress Controller which routes it to the appropriate service based on the hostname. This is an example of what a Traefik configuration for a branch deploy may look like:",{"code":694,"_type":697,"_key":698},{"code":695,"_type":696},"http:\n  routers: \n    tilt:\n      rule: Host (\"cool-meadow-380.ivy.co.clearstreet.io\")\n      service: tilt\n      tls：\n        domains:\n        - main: cool-meadow-380.ivy.co.clearstreet.io \n      traefik:\n        rule: Host (\"traefik.cool-meadow 380.ivy.co.clearstreet.io\")\n        service: api@internal\n        tls：\n          domains:\n          -main: traefik.cool-meadow-380.ivy.co.clearstreet.io\n  web:\n      rule: Host(\"web.cool-meadow-380. ivy. co. clearstreet.io\")\n      service: web\n      tlS：\n        domains:\n        - main: web.cool-meadow-380.ivy.co.clearstreet.io\n  services:\n    tilt:\n      loadBalancer: \n        servers:\n        -url: http://localhost:10350\n    web:\n      loadBalancer: \n        servers:\n          - url: http://web.localkube.co.clearstreet.io:8085\n  middlewares: \n    web:\n      headers:\n        customRequestHeaders:\n          url: web.localkube.co.clearstreet.io","code","codeBlock","4969ee298bef",{"style":43,"_key":700,"markDefs":701,"children":702,"_type":42},"d86f34296568",[],[703],{"_key":704,"_type":48,"marks":705,"text":706},"d86f342965680",[],"Routing requests to certain services, such as Tilt, which run outside of the kind cluster is straightforward. As the example Traefik shows, we just route such requests to localhost with the appropriate port. However, \"handing off requests to the Ingress Controller\" to forward requests to the kind cluster is a bit trickier.",{"markDefs":708,"children":709,"_type":42,"style":275,"_key":714},[],[710],{"text":711,"_key":712,"_type":48,"marks":713},"Getting Ingresses to Work","40adcaf43fe60",[50],"40adcaf43fe6",{"children":716,"_type":42,"style":43,"_key":730,"markDefs":731},[717,721,726],{"_key":718,"_type":48,"marks":719,"text":720},"6d1629c0a27f0",[],"Our kind cluster is exposed on localhost:8085. That means that requests to 127.0.0.1:8085 are routed to the Ingress Controller in the kind cluster. Great! We can get networking traffic into the cluster. However, we're still left with one problem. For the Ingress Controller to be able to route traffic, it needs hostname information. ",{"_key":722,"_type":48,"marks":723,"text":725},"6d1629c0a27f1",[724],"dec0d04f5a16","To get Ingresses to work in localkube",{"text":727,"_key":728,"_type":48,"marks":729}," we added a DNS entry to our internal network which points *.localkube.co.clearstreet.io to 127.0.0.1. With that, we can curl web.localkube.co.clearstreet.io:8085 and the request is properly routed to the service in the kind cluster.","6d1629c0a27f2",[],"6d1629c0a27f",[732],{"_type":71,"to":162,"_key":724},{"children":734,"_type":42,"style":43,"_key":738,"markDefs":739},[735],{"_type":48,"marks":736,"text":34,"_key":737},[],"9196b053759f0","9196b053759f",[],{"children":741,"_type":42,"style":43,"_key":746,"markDefs":747},[742],{"text":743,"_key":744,"_type":48,"marks":745},"Now, all that’s left is pointing incoming requests for services in the kind cluster to the Ingress Controller. As the example Traefik config illustrates, when a request comes into Traefik for web.cool-meadow-380.ivy.co.clearstreet.io the URL header is rewritten to web.localkube.co.clearstreet.io and we forward the request to port 8085. With this setup, a developer or user can type in web.cool-meadow-380.ivy.co.clearstreet.io in their browser and access an instance of the website running in their branch deploy.","73ac917e49200",[],"73ac917e4920",[],{"markDefs":749,"children":750,"_type":42,"style":275,"_key":755},[],[751],{"_type":48,"marks":752,"text":753,"_key":754},[50],"Making Ivy Fast","b13b4f3ceed90","b13b4f3ceed9",{"_key":757,"markDefs":758,"children":759,"_type":42,"style":43},"a9d2f338fb94",[],[760],{"_type":48,"marks":761,"text":762,"_key":763},[],"Branch deploy creation initially took 10 to 15 minutes. While this was a great start, we felt it was too slow to make branch deploys a natural part of a user’s workflow. Our goal was to reduce branch deploy creation time to sub 5 minutes. Fast enough that once you’ve kicked off a branch deploy creation it would be done by the time you read a few emails or responded to some Slack messages.","a9d2f338fb940",{"_type":42,"style":43,"_key":765,"markDefs":766,"children":767},"b1c2fb58079c",[],[768],{"_type":48,"marks":769,"text":34,"_key":770},[],"b1c2fb58079c0",{"markDefs":772,"children":776,"_type":42,"style":43,"_key":789},[773],{"_type":71,"to":774,"_key":775},"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html","6289c48295e3",[777,781,785],{"_key":778,"_type":48,"marks":779,"text":780},"bd0bdd60af8b0",[],"We realized early on that branch deploy creation was mainly taken up by machine provisioning and dependency installation. There wasn’t much we could do to bring down machine creation time. We could have had “hot” machines ready to go but that would increase cost and we didn’t feel initial usage would warrant it, although we may revisit the idea in the future. Instead, we decided to create an ",{"_key":782,"_type":48,"marks":783,"text":784},"bd0bdd60af8b1",[775],"AMI",{"marks":786,"text":787,"_key":788,"_type":48},[]," which has all of the dependencies pre-installed using a nightly cron job. Using this AMI significantly improved branch deploy creation times. Now branch deploys take only 4 to 5 minutes to start up.","bd0bdd60af8b2","bd0bdd60af8b",{"style":275,"_key":791,"markDefs":792,"children":793,"_type":42},"696fccc742c9",[],[794],{"text":795,"_key":796,"_type":48,"marks":797},"Ivy in Action","696fccc742c90",[50],{"markDefs":799,"children":800,"_type":42,"style":43,"_key":805},[],[801],{"_key":802,"_type":48,"marks":803,"text":804},"b8897637a8090",[],"We released Ivy internally in September and have gotten great feedback from engineers as well as other stakeholders, allowing us to quickly iterate on pain points and improve Ivy. Our teams are actively using branch deploys to test frontend changes as well as backend improvements. To date, Ivy has performed around 500 branch deploys, and that number is set to keep growing. As the below graph shows, almost all branch deploys are active for less than two days, indicating that our users are truly taking advantage of branch deploys to quickly test changes, terminate once testing is complete, and spin up new branch deploys for other tests.","b8897637a809",{"markDefs":807,"children":808,"_type":42,"style":43,"_key":812},[],[809],{"_type":48,"marks":810,"text":34,"_key":811},[],"d815ac7f4cec0","d815ac7f4cec",{"width":814,"hotspot":5,"asset":815,"caption":817,"_type":449,"alt":824,"height":826,"extension":23,"url":827,"_key":828,"children":5},1280,{"_ref":816,"_type":26},"image-f8742f6de1174723ccdf5651cc54167dcd4c0083-1280x379-png",[818],{"_type":42,"style":43,"_key":819,"markDefs":820,"children":821},"fdf7c48d701e",[],[822],{"marks":823,"text":824,"_key":825,"_type":48},[],"Distribution of branch deploy uptime over one month","fdf7c48d701e0",379,"https://cdn.sanity.io/images/40fnhjbe/production/f8742f6de1174723ccdf5651cc54167dcd4c0083-1280x379.png","58717b8bd09e",{"children":830,"_type":42,"style":43,"_key":834,"markDefs":835},[831],{"_type":48,"marks":832,"text":34,"_key":833},[],"a5b95a6174a50","a5b95a6174a5",[],{"_type":42,"style":275,"_key":837,"markDefs":838,"children":839},"fde838720d5c",[],[840],{"marks":841,"text":842,"_key":843,"_type":48},[50],"The Future of Ivy","fde838720d5c0",{"style":43,"_key":845,"markDefs":846,"children":850,"_type":42},"2f8a72d6877e",[847],{"_type":71,"to":848,"_key":849},"https://www.snowflake.com/","471f17e28bda",[851,855,859],{"_type":48,"marks":852,"text":853,"_key":854},[],"Ivy has made branch deploys — on-demand, ephemeral, isolated environments — a reality at Clear Street. Since its release, we’ve added features such as custom instance sizes and significantly improved branch deploy creation times. We’re also working on onboarding more technologies such as ","2f8a72d6877e0",{"_key":856,"_type":48,"marks":857,"text":858},"2f8a72d6877e1",[849],"Snowflake",{"marks":860,"text":861,"_key":862,"_type":48},[]," to branch deploys and improving the developer experience by making seeding a branch deploy environment with useful data as easy as clicking a button.","2f8a72d6877e2",{"markDefs":864,"children":865,"_type":42,"style":43,"_key":869},[],[866],{"_type":48,"marks":867,"text":34,"_key":868},[],"a678498f95540","a678498f9554",{"_type":42,"style":43,"_key":871,"markDefs":872,"children":877},"272363b9cd01",[873,875],{"_type":71,"to":162,"_key":874},"e90d8bf98fd5",{"_type":71,"to":202,"_key":876},"3b7d2841ba0b",[878,882,885,889,893],{"_type":48,"marks":879,"text":880,"_key":881},[],"We’ve learned that the ability to create isolated and ephemeral environments is very powerful. We have plans to use Ivy to support robust end-to-end testing of our system and have even thought about using Ivy to build public sandboxes and extend Ivy to create on-demand development environments. We’ve also learned that investing in robust developer tooling is worth the effort and that onboarding one tool can open the door to many possibilities. In Ivy’s case, previous work setting up a ","272363b9cd010",{"text":171,"_key":883,"_type":48,"marks":884},"272363b9cd011",[874],{"_key":886,"_type":48,"marks":887,"text":888},"272363b9cd012",[]," and bringing ",{"_type":48,"marks":890,"text":891,"_key":892},[876],"service-level deploys to Clear Street","272363b9cd013",{"_type":48,"marks":894,"text":895,"_key":896},[]," in addition to investing in tools like Terraform is what made branch deploys possible.","272363b9cd014",{"markDefs":898,"children":899,"_type":42,"style":43,"_key":903},[],[900],{"_type":48,"marks":901,"text":34,"_key":902},[],"ec05f8a6521c0","ec05f8a6521c",{"style":43,"_key":905,"markDefs":906,"children":907,"_type":42},"d438ba287b08",[],[908],{"_type":48,"marks":909,"text":910,"_key":911},[],"Co-authored by:","d438ba287b080",{"style":43,"_key":913,"markDefs":914,"children":915,"_type":42},"b80fcd27dc31",[],[916],{"_type":48,"marks":917,"text":918,"_key":919},[],"Joseph DeChicchis & Frank Bagherzadeh","b80fcd27dc310",[],{"disclaimer":922,"footerItems":949,"legalItems":981,"legalText":5,"socialNetworks":991,"address":1009},[923,933],{"markDefs":924,"children":927,"_type":42,"style":43,"_key":932},[925],{"href":100,"_key":926,"_type":71},"d38625939708",[928],{"_type":48,"marks":929,"text":930,"_key":931},[],"Products and services are offered by Clear Street LLC as a Broker Dealer member FINRA and SIPC and a Futures Commission Merchant registered with the CFTC and member of NFA. ","331699fdb6140","b41b74ae73bb",{"style":43,"_key":934,"markDefs":935,"children":937,"_type":42},"dbec5081eda7",[936],{"_type":71,"href":100,"_key":926},[938,942,945],{"_type":48,"marks":939,"text":940,"_key":941},[],"Additional information about Clear Street is available on FINRA ","42e587e4d749",{"_type":48,"marks":943,"text":82,"_key":944},[926],"4894062c01ca",{"_type":48,"marks":946,"text":947,"_key":948},[],", including its Customer Relationship Summary and NFA BASIC | NFA (futures.org).","6db9006e1b4a",[950,963,975],{"title":132,"pages":951},[952,956,959,962],{"type":953,"title":954,"slug":955},"internal","About","about",{"type":953,"title":957,"slug":958},"News & Content","news",{"type":953,"title":960,"slug":961},"Careers","careers",{"type":953,"title":112,"slug":113},{"title":964,"pages":965},"Services",[966,969,972],{"type":953,"title":967,"slug":968},"Institutional","institutional",{"type":953,"title":970,"slug":971},"Professional Clearing","professional-clearing",{"type":953,"title":973,"slug":974},"Active Trader","active-trader",{"title":976,"pages":977},"Products",[978],{"type":953,"title":979,"slug":980},"Studio","studio",[982,985,988],{"title":983,"slug":984},"Regulatory Disclosures","regulatory-disclosures",{"title":986,"slug":987},"Privacy Policy","privacy-policy",{"title":989,"slug":990},"Security","security",[992,997,1001,1005],{"link":993,"socialNetwork":994,"_key":995,"_type":996},"https://github.com/clear-street","github","466192507eea","links",{"_type":996,"link":998,"socialNetwork":999,"_key":1000},"https://www.linkedin.com/company/clear-street","linkedin","43f9fa8f49d0",{"_type":996,"link":1002,"socialNetwork":1003,"_key":1004},"https://www.youtube.com/@ClearStreetNYC","youtube","b581a744d770",{"_type":996,"link":1006,"socialNetwork":1007,"_key":1008},"https://open.spotify.com/show/3Bbl6x17ZSdnijTTDq6tKi","spotify","7625c0ffc2b2","4 World Trade Center\n150 Greenwich St Floor 45\nNew York, NY 10007\n(646) 845-0036",1733511757493]